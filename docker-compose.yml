# MVP Tile Server - Docker Compose Configuration
#
# Setup:
#   1. Copy .env.example to .env and customize values
#   2. Edit config/config.json to define your tilesets
#   3. Run: docker-compose up
#
# Tile Data Mounting:
#   The server expects tiles at /app/data inside the container.
#   Set TILE_DATA_PATH in .env to point to your tile data directory.
#
#   Example structure:
#     /app/data/
#       osm/              -> directory tileset
#       satellite.tar     -> tar archive tileset
#       topo.tar.gz       -> compressed tar tileset
#
#   Then reference in config/config.json as:
#     "osm": "/app/data/osm"
#     "satellite": "/app/data/satellite.tar"
#
# Usage:
#   1. Edit the volumes section below to mount your tile data
#   2. Update config.json to match your tileset paths
#   3. Run: docker-compose up

services:
  tile-server:
    build: .
    ports:
      - "${TILE_SERVER_PORT:-8000}:8000"
    env_file:
      - ./env/.env
    volumes:
      # Config file (required)
      - ./config/config.json:/app/config.json:ro

      # Tile data mount - set TILE_DATA_PATH in .env
      - ${TILE_DATA_PATH:-./test_data}:/app/data:ro

      # Alternative: Mount individual tilesets (uncomment and customize)
      # - /path/to/osm/tiles:/app/data/osm:ro
      # - /path/to/satellite.tar:/app/data/satellite.tar:ro

    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
